.container.breadcrumbs
  =link_to "Home", root_path
  %span.arrow >
  Services

.container.white_bg
  #pattern_links{ class: "active_#{@selected_pattern.try(:slug)}" }
    = link_to 'All patterns', services_path, class: "single_pattern fg_brand"
    - @patterns.each do |pattern|
      = link_to pattern.name.chomp(" something").chomp(" for"), filter_by_pattern_path(pattern.slug), class: "single_pattern #{pattern.name.parameterize}", title: "View services under the #{pattern.name} pattern"
  .description
    - if @selected_pattern
      .description
        %h3
          = @selected_pattern.name
          pattern
        = @selected_pattern.description.html_safe
    - else
      .description
        %h3 All patterns

        %p
          So far, we’ve mapped around 150 services, covering everything from ‘register a birth’ to ‘report a pothole’.
          %span.bold And we’ve identified seven common service patterns.

        %p.bold You can browse each pattern with examples of services that use them by following the links.

        %p You can add your own services to this library and tell us what common patterns they use. There’s also an opportunity to provide extra details like what steps they include, what type of organisation they sit in or what type of life event they are part of.

        %p.mb
          Alternatively, if you want to amend or comment on existing services, you can email us directly at
          %strong
            =mail_to ENV['ADMIN_EMAIL']

    = link_to "Add a new service", new_service_path, class: 'button'


.pattern_table.table.container.full_container
  - if @selected_pattern
    = form_tag(filter_by_pattern_path(@selected_pattern.slug), method: :get) do
      = label_tag "Filter by life event"
      = select_tag "life_event_select", options_from_collection_for_select(@life_events, "id", "name", @selected_life_event.try(:id)), onchange: 'this.form.submit();', include_blank: "--Select a life event--"
  - else
    = form_tag(services_path, method: :get) do
      = label_tag "Filter by life event"
      = select_tag "life_event_select", options_from_collection_for_select(@life_events, "id", "name", @selected_life_event.try(:id)), onchange: 'this.form.submit();', include_blank: "--Select a life event--"
  %h2="#{@services.count} total services"
  .row.head_row
    .table__head.third Service name
    .table__head.quarter Patterns
    .table__head.quarter Life events
    .table__head.two_col Organisation
  - @services.each do |service|
    =link_to service_path(service), class: 'row data_row' do
      .table__data.third.service__name
        = service.name
      .table__data.quarter
        .only_mobile.bold Patterns:
        - service.patterns.each do |service_pattern|
          .single_pattern{ class: service_pattern.name.parameterize }
            = service_pattern.name
      .table__data.quarter
        - if service.life_events.any?
          .only_mobile.bold Life events:
        - service.life_events.each do |life_event|
          .single_pattern.not_pattern
            = life_event.name
      .table__data.two_col
        .only_mobile.bold Organisation:
        - service.organisation_types.each do |org_type|
          = org_type

.container.full_container
  = link_to "Add a new service", new_service_path, class: 'button right'
